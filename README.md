# YouTuberoid(Android YouTubeダウンロードアプリ)

YouTubeから動画をダウンロードします

- URLを手入力します

- ブラウザから動画のページを共有します

- 内臓ブラウザでページを遷移して、ページを共有からURLを表示してタップ(ページ遷移)します 

## 動作仕様

- 入力された文字列から動画IDを取り出します
  - "http"で始まっていなかったら動画IDそのもの
  - "http"で始まっていたら
    - "v="が含まれていたら、それ以降'&'の前までが動画ID
    - 含まれていなかったら最後の'/'以降が動画ID

- "https://www.youtube.com/watch?v=" + 動画IDのページをダウンロードして下記を解析します
  "ytplayer.config = "から";ytplayer.load"までをJSONとして扱います
- JSONから"cfg"を取り出します
- "cfg"から"args"を取り出します
- "args"から"player_response"."streamingData"."formats"を取り出します
  -> url_encoded_fmt_stream_map
- "args"から"player_response"."streamingData"."adaptiveFormats"を取り出します
  -> adaptive_fmts

## ページ内容サンプル
```
I/System.out: cfg: {"assets":{"js":"\/yts\/jsbin\/player_ias-vfl7dr5gL\/en_US\/base.js","css":"\/yts\/cssbin\/player-vfl0tglhl\/www-player-webp.css"},"attrs":{"id":"movie_player"},"args":{"loaderUrl":"https:\/\/www.youtube.com\/watch?v=9dRt5SldKAY","adaptive_fmts":"url=https%3A%2F%2Fr1---sn-oguelner.googlevideo.com%2Fvideoplayback%3Fexpire%3D1578729034%26ei%3D6ikZXsLECpaQgAO0hagY%26ip%3D240b%253A11%253A4fc0%253A2200%253Af4e3%253A4c22%253A8447%253A3b52%26id%3Do-AEPuSVFqi8JUGfOZZ_PxjAgCZ2HlAGJgNx96srB7scyD%26itag%3D137%26aitags%3D133%252C134%252C135%252C136%252C137%252C160%252C242%252C243%252C244%252C247%252C248%252C278%26source%3Dyoutube%26requiressl%3Dyes%26mm%3D31%252C29%26mn%3Dsn-oguelner%252Csn-ogul7n7s%26ms%3Dau%252Crdu%26mv%3Dm%26mvi%3D0%26pl%3D26%26initcwndbps%3D2160000%26vprv%3D1%26mime%3Dvideo%252Fmp4%26gir%3Dyes%26clen%3D35881393%26dur%3D264.497%26lmt%3D1576381215423374%26mt%3D1578707323%26fvip%3D1%26keepalive%3Dyes%26fexp%3D23842630%26c%3DWEB%26txp%3D5432432%26sparams%3Dexpire%252Cei%252Cip%252Cid%252Caitags%252Csource%252Crequiressl%252Cvprv%252Cmime%252Cgir%252Cclen%252Cdur%252Clmt%26sig%3DALgxI2wwRAIgCMbkH4uRS5C2OIb04Db4dmyRpdT8E5XD0ioEAPimVGoCIDUeDu3TL_cnTBkAFpShDY_1JMoajgvll7V0AuSUQc5z%26lsparams%3Dmm%252Cmn%252Cms%252Cmv%252Cmvi%252Cpl%252Cinitcwndbps%26lsig%3DAHylml4wRQIgT9_eRsRlkqa5CBfomyI55O_YVWB8Sf8-YGVY1U6jO5cCIQDSK381OiVtq8XJ48vPb0e5qNQ4rH7ctR9qqgKCJW1E7w%253D%253D\u0026size=1920x1080\u0026clen=35881393\u0026xtags=\u0026itag=137\u0026index=741-1384\u0026quality_label=1080p\u0026init=0-740\u0026lmt=1576381215423374\u0026projection_type=1\u0026bitrate=2238240\u0026fps=30\u0026type=video%2Fmp4%3B+codecs%3D%22avc1.640028%22,url=https%3A%2F%2Fr1---sn-oguelner.googlevideo.com%2Fvideoplayback%3Fexpire%3D1578729034%26ei%3D6ikZXsLECpaQgAO0hagY%26ip%3D240b%253A11%253A4fc0%253A2200%253Af4e3%253A4c22%253A8447%253A3b52%26id%3Do-AEPuSVFqi8JUGfOZZ_PxjAgCZ2HlAGJgNx96srB7scyD%26itag%3D248%26aitags%3D133%252C134%252C135%252C136%252C137%252C160%252C242%252C243%252C244%252C247%252C248%252C278%26source%3Dyoutube%26requiressl%3Dyes%26mm%3D31%252C29%26mn%3Dsn-oguelner%252Csn-ogul7n7s%26ms%3Dau%252Crdu%26mv%3Dm%26mvi%3D0%26pl%3D26%26initcwndbps%3D2160000%26vprv%3D1%26mime%3Dvideo%252Fwebm%26gir%3Dyes%26clen%3D42317931%26dur%3D264.497%26lmt%3D1576381160615366%26mt%3D1578707323%26fvip%3D1%26keepalive%3Dyes%26fexp%3D23842630%26c%3DWEB%26txp%3D5431432%26sparams%3Dexpire%252Cei%252Cip%252Cid%252Caitags%252Csource%252Crequiressl%252Cvprv%252Cmime%252Cgir%252Cclen%252Cdur%252Clmt%26sig%3DALgxI2wwRQIhAIqhWMag1rPsJefD43CL7E09a_S5GEZ9JlM8Xtkko16wAiBE79S_ALpbYf0rOWbxDewqNb_zVDgWBQV6YJ5jXpIbDA%253D%253D%26lsparams%3Dmm%252Cmn%252Cms%252Cmv%252Cmvi%252Cpl%252Cinitcwndbps%26lsig%3DAHylml4wRQIgT9_eRsRlkqa5CBfomyI55O_YVWB8Sf8-YGVY1U6jO5cCIQDSK381OiVtq8XJ48vPb0e5qNQ4rH7ctR9qqgKCJW1E7w%253D%253D\u0026size=1920x1080\u0026clen=42317931\u0026xtags=\u0026itag=248\u0026index=220-1108\u0026quality_label=1080p\u0026init=0-219\u0026lmt=1576381160615366\u0026primaries=bt709\u0026projection_type=1\u0026bitrate=2273498\u0026fps=30\u0026type=video%2Fwebm%3B+codecs%3D%22vp9%22\u0026eotf=bt709,url=https%3A%2F%2Fr1---sn-oguelner.googlevideo.com%2Fvideoplayback%3Fexpire%3D1578729034%26ei%3D6ikZXsLECpaQgAO0hagY%26ip%3D240b%253A11%253A4fc0%253A2200%253Af4e3%253A4c22%253A8447%253A3b52%26id%3Do-AEPuSVFqi8JUGfOZZ_PxjAgCZ2HlAGJgNx96srB7scyD%26itag%3D136%26aitags%3D133%252C134%252C135%252C136%252C137%252C160%252C242%252C243%252C244%252C247%252C248%252C278%26source%3Dyoutube%26requiressl%3Dyes%26mm%3D31%252C29%26mn%3Dsn-oguelner%252Csn-ogul7n7s%26ms%3Dau%252Crdu%26mv%3Dm%26mvi%3D0%26pl%3D26%26initcwndbps%3D2160000%26vprv%3D1%26mime%3Dvideo%252Fmp4%26gir%3Dyes%26clen%3D20735401%26dur%3D264.497%26lmt%3D1576381207218435%26mt%3D1578707323%26fvip%3D1%26keepalive%3Dyes%26fexp%3D23842630%26c%3DWEB%26txp%3D5432432%26sparams%3Dexpire%252Cei%252Cip%252Cid%252Caitags%252Csource%252Crequiressl%252Cvprv%252Cmime%252Cgir%252Cclen%252Cdur%252Clmt%26sig%3DALgxI2wwRgIhAKJN-0xv3ms7rknWmcq83el0bYsQEk5mCSABjmgb5zTnAiEA5wg4T472gwtr9rxDUqoFoi0iUiiL6rUL_BiHxmN
I/System.out: args: {"ps":"desktop-polymer","hl":"en_US","cos":"Windows","external_fullscreen":true,"gapi_hint_params":"m;/_/scs/abc-static/_/js/k=gapi.gapi.en.MEVzAPCznC8.O/d=1/ct=zgms/rs=AHpOoo_iL6i3Fuh5d3bLKRBazYvzpKjkxg/m=__features__","show_miniplayer_button":"1","cver":"2.20200108.07.02","fmt_list":"18/640x360","enablecsi":"1","vss_host":"s.youtube.com","csi_page_type":"watch","fexp":"23722138,23744176,23804281,23815435,23821390,23827263,23835658,23837040,23837993,23839597,23842630,23847144,23848795,23851754,23854049,23855886,23857950,23858001,23859802,23859863,23861041,23864294,23864328,23865644,23866395,23866807,23867648,23868285,23868330,23868461,23868461,23870088,23870144,24630396,9449243,9471235","innertube_context_client_version":"2.20200108.07.02","cbrver":"72.0.3626.121","timestamp":"1578707434","watermark":",https://s.ytimg.com/yts/img/watermark/youtube_watermark-vflHX6b6E.png,https://s.ytimg.com/yts/img/watermark/youtube_hd_watermark-vflAzLcD6.png","c":"WEB","url_encoded_fmt_stream_map":"type=video%2Fmp4%3B+codecs%3D%22avc1.42001E%2C+mp4a.40.2%22&itag=18&url=https%3A%2F%2Fr1---sn-oguelner.googlevideo.com%2Fvideoplayback%3Fexpire%3D1578729034%26ei%3D6ikZXsLECpaQgAO0hagY%26ip%3D240b%253A11%253A4fc0%253A2200%253Af4e3%253A4c22%253A8447%253A3b52%26id%3Do-AEPuSVFqi8JUGfOZZ_PxjAgCZ2HlAGJgNx96srB7scyD%26itag%3D18%26source%3Dyoutube%26requiressl%3Dyes%26mm%3D31%252C29%26mn%3Dsn-oguelner%252Csn-ogul7n7s%26ms%3Dau%252Crdu%26mv%3Dm%26mvi%3D0%26pl%3D26%26initcwndbps%3D2160000%26vprv%3D1%26mime%3Dvideo%252Fmp4%26gir%3Dyes%26clen%3D15916297%26ratebypass%3Dyes%26dur%3D264.591%26lmt%3D1576381005520165%26mt%3D1578707323%26fvip%3D1%26fexp%3D23842630%26c%3DWEB%26txp%3D5431432%26sparams%3Dexpire%252Cei%252Cip%252Cid%252Citag%252Csource%252Crequiressl%252Cvprv%252Cmime%252Cgir%252Cclen%252Cratebypass%252Cdur%252Clmt%26sig%3DALgxI2wwRAIgN_zKK66OH0heo9oxsijfP1JftbmR0EOr68NLVXYDr5sCIAQacgsx7RLwSfIV43nHPCsEJdJCkTnc8jDsHaOC3wFv%26lsparams%3Dmm%252Cmn%252Cms%252Cmv%252Cmvi%252Cpl%252Cinitcwndbps%26lsig%3DAHylml4wRQIgT9_eRsRlkqa5CBfomyI55O_YVWB8Sf8-YGVY1U6jO5cCIQDSK381OiVtq8XJ48vPb0e5qNQ4rH7ctR9qqgKCJW1E7w%253D%253D&quality=medium","player_response":"{\"playabilityStatus\":{\"status\":\"OK\",\"playableInEmbed\":true,\"miniplayer\":{\"miniplayerRenderer\":{\"playbackMode\":\"PLAYBACK_MODE_ALLOW\"}},\"contextParams\":\"Q0FFU0FnZ0I=\"},\"streamingData\":{\"expiresInSeconds\":\"21540\",\"formats\":[{\"itag\":18,\"url\":\"https://r1---sn-oguelner.googlevideo.com/videoplayback?expire=1578729034\\u0026ei=6ikZXsLECpaQgAO0hagY\\u0026ip=240b%3A11%3A4fc0%3A2200%3Af4e3%3A4c22%3A8447%3A3b52\\u0026id=o-AEPuSVFqi8JUGfOZZ_PxjAgCZ2HlAGJgNx96srB7scyD\\u0026itag=18\\u0026source=youtube\\u0026requiressl=yes\\u0026mm=31%2C29\\u0026mn=sn-oguelner%2Csn-ogul7n7s\\u0026ms=au%2Crdu\\u0026mv=m\\u0026mvi=0\\u0026pl=26\\u0026initcwndbps=2160000\\u0026vprv=1\\u0026mime=video%2Fmp4\\u0026gir=yes\\u0026clen=15916297\\u0026ratebypass=yes\\u0026dur=264.591\\u0026lmt=1576381005520165\\u0026mt=1578707323\\u0026fvip=1\\u0026fexp=23842630\\u0026c=WEB\\u0026txp=5431432\\u0026sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cvprv%2Cmime%2Cgir%2Cclen%2Cratebypass%2Cdur%2Clmt\\u0026sig=ALgxI2wwRAIgN_zKK66OH0heo9oxsijfP1JftbmR0EOr68NLVXYDr5sCIAQacgsx7RLwSfIV43nHPCsEJdJCkTnc8jDsHaOC3wFv\\u0026lsparams=mm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps\\u0026lsig=AHylml4wRQIgT9_eRsRlkqa5CBfomyI55O_YVWB8Sf8-YGVY1U6jO5cCIQDSK381OiVtq8XJ48vPb0e5qNQ4rH7ctR9qqgKCJW1E7w%3D%3D\",\"mimeType\":\"video/mp4; codecs=\\\"avc1.42001E, mp4a.40.2\\\"\",\"bitrate\":481405,\"width\":640,\"height\":360,\"lastModified\":\"1576381005520165\",\"contentLength\":\"15916297\",\"quality\":\"medium\",\"qualityLabel\":\"360p\",\"projectionType\":\"RECTANGULAR\",\"averageBitrate\":481234,\"audioQuality\":\"AUDIO_QUALITY_LOW\",\"approxDurationMs\":\"264591\",\"audioSampleRate\":\"44100\",\"audioChannels\":2}],\"adaptiveFormats\":[{\"itag\":137,\"url\":\"https://r1---sn-oguelner.googlevideo.com/videoplayback?expire=1578729034\\u0026ei=6ikZXsLECpaQgAO0hagY\\u0026ip=240b%3A11%3A4f
I/System.out: url_encoded_fmt_stream_map: [{"itag":18,"projectionType":"RECTANGULAR","bitrate":481405,"mimeType":"video/mp4; codecs=\"avc1.42001E, mp4a.40.2\"","audioQuality":"AUDIO_QUALITY_LOW","approxDurationMs":"264591","url":"https://r1---sn-oguelner.googlevideo.com/videoplayback?expire=1578729034&ei=6ikZXsLECpaQgAO0hagY&ip=240b%3A11%3A4fc0%3A2200%3Af4e3%3A4c22%3A8447%3A3b52&id=o-AEPuSVFqi8JUGfOZZ_PxjAgCZ2HlAGJgNx96srB7scyD&itag=18&source=youtube&requiressl=yes&mm=31%2C29&mn=sn-oguelner%2Csn-ogul7n7s&ms=au%2Crdu&mv=m&mvi=0&pl=26&initcwndbps=2160000&vprv=1&mime=video%2Fmp4&gir=yes&clen=15916297&ratebypass=yes&dur=264.591&lmt=1576381005520165&mt=1578707323&fvip=1&fexp=23842630&c=WEB&txp=5431432&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cvprv%2Cmime%2Cgir%2Cclen%2Cratebypass%2Cdur%2Clmt&sig=ALgxI2wwRAIgN_zKK66OH0heo9oxsijfP1JftbmR0EOr68NLVXYDr5sCIAQacgsx7RLwSfIV43nHPCsEJdJCkTnc8jDsHaOC3wFv&lsparams=mm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AHylml4wRQIgT9_eRsRlkqa5CBfomyI55O_YVWB8Sf8-YGVY1U6jO5cCIQDSK381OiVtq8XJ48vPb0e5qNQ4rH7ctR9qqgKCJW1E7w%3D%3D","audioSampleRate":"44100","quality":"medium","qualityLabel":"360p","audioChannels":2,"width":640,"contentLength":"15916297","lastModified":"1576381005520165","height":360,"averageBitrate":481234}]
I/System.out: adaptive_fmts: [{"itag":137,"indexRange":{"start":"741","end":"1384"},"fps":30,"projectionType":"RECTANGULAR","initRange":{"start":"0","end":"740"},"bitrate":2238240,"mimeType":"video/mp4; codecs=\"avc1.640028\"","approxDurationMs":"264497","url":"https://r1---sn-oguelner.googlevideo.com/videoplayback?expire=1578729034&ei=6ikZXsLECpaQgAO0hagY&ip=240b%3A11%3A4fc0%3A2200%3Af4e3%3A4c22%3A8447%3A3b52&id=o-AEPuSVFqi8JUGfOZZ_PxjAgCZ2HlAGJgNx96srB7scyD&itag=137&aitags=133%2C134%2C135%2C136%2C137%2C160%2C242%2C243%2C244%2C247%2C248%2C278&source=youtube&requiressl=yes&mm=31%2C29&mn=sn-oguelner%2Csn-ogul7n7s&ms=au%2Crdu&mv=m&mvi=0&pl=26&initcwndbps=2160000&vprv=1&mime=video%2Fmp4&gir=yes&clen=35881393&dur=264.497&lmt=1576381215423374&mt=1578707323&fvip=1&keepalive=yes&fexp=23842630&c=WEB&txp=5432432&sparams=expire%2Cei%2Cip%2Cid%2Caitags%2Csource%2Crequiressl%2Cvprv%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=ALgxI2wwRAIgCMbkH4uRS5C2OIb04Db4dmyRpdT8E5XD0ioEAPimVGoCIDUeDu3TL_cnTBkAFpShDY_1JMoajgvll7V0AuSUQc5z&lsparams=mm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AHylml4wRQIgT9_eRsRlkqa5CBfomyI55O_YVWB8Sf8-YGVY1U6jO5cCIQDSK381OiVtq8XJ48vPb0e5qNQ4rH7ctR9qqgKCJW1E7w%3D%3D","quality":"hd1080","qualityLabel":"1080p","width":1920,"contentLength":"35881393","lastModified":"1576381215423374","height":1080,"averageBitrate":1085271},{"itag":248,"indexRange":{"start":"220","end":"1108"},"fps":30,"projectionType":"RECTANGULAR","initRange":{"start":"0","end":"219"},"bitrate":2273498,"mimeType":"video/webm; codecs=\"vp9\"","approxDurationMs":"264497","url":"https://r1---sn-oguelner.googlevideo.com/videoplayback?expire=1578729034&ei=6ikZXsLECpaQgAO0hagY&ip=240b%3A11%3A4fc0%3A2200%3Af4e3%3A4c22%3A8447%3A3b52&id=o-AEPuSVFqi8JUGfOZZ_PxjAgCZ2HlAGJgNx96srB7scyD&itag=248&aitags=133%2C134%2C135%2C136%2C137%2C160%2C242%2C243%2C244%2C247%2C248%2C278&source=youtube&requiressl=yes&mm=31%2C29&mn=sn-oguelner%2Csn-ogul7n7s&ms=au%2Crdu&mv=m&mvi=0&pl=26&initcwndbps=2160000&vprv=1&mime=video%2Fwebm&gir=yes&clen=42317931&dur=264.497&lmt=1576381160615366&mt=1578707323&fvip=1&keepalive=yes&fexp=23842630&c=WEB&txp=5431432&sparams=expire%2Cei%2Cip%2Cid%2Caitags%2Csource%2Crequiressl%2Cvprv%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=ALgxI2wwRQIhAIqhWMag1rPsJefD43CL7E09a_S5GEZ9JlM8Xtkko16wAiBE79S_ALpbYf0rOWbxDewqNb_zVDgWBQV6YJ5jXpIbDA%3D%3D&lsparams=mm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AHylml4wRQIgT9_eRsRlkqa5CBfomyI55O_YVWB8Sf8-YGVY1U6jO5cCIQDSK381OiVtq8XJ48vPb0e5qNQ4rH7ctR9qqgKCJW1E7w%3D%3D","quality":"hd1080","qualityLabel":"1080p","width":1920,"contentLength":"42317931","lastModified":"1576381160615366","colorInfo":{"primaries":"COLOR_PRIMARIES_BT709","matrixCoefficients":"COLOR_MATRIX_COEFFICIENTS_BT709","transferCharacteristics":"COLOR_TRANSFER_CHARACTERISTICS_BT709"},"height":1080,"averageBitrate":1279951},{"itag":136,"indexRange":{"start":"739","end":"1382"},"fps":30,"projectionType":"RECTANGULAR","initRange":{"start":"0","end":"738"},"bitrate":1293413,"mimeType":"video/mp4; codecs=\"avc1.4d401f\"","approxDurationMs":"264497","url":"https://r1---sn-oguelner.googlevideo.com/videoplayback?expire=1578729034&ei=6ikZXsLECpaQgAO0hagY&ip=240b%3A11%3A4fc0%3A2200%3Af4e3%3A4c22%3A8447%3A3b52&id=o-AEPuSVFqi8JUGfOZZ_PxjAgCZ2HlAGJgNx96srB7scyD&itag=136&aitags=133%2C134%2C135%2C136%2C137%2C160%2C242%2C243%2C244%2C247%2C248%2C278&source=youtube&requiressl=yes&mm=31%2C29&mn=sn-oguelner%2Csn-ogul7n7s&ms=au%2Crdu&mv=m&mvi=0&pl=26&initcwndbps=2160000&vprv=1&mime=video%2Fmp4&gir=yes&clen=20735401&dur=264.497&lmt=1576381207218435&mt=1578707323&fvip=1&keepalive=yes&fexp=23842630&c=WEB&txp=5432432&sparams=expire%2Cei%2Cip%2Cid%2Caitags%2Csource%2Crequiressl%2Cvprv%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=ALgxI2wwRgIhAKJN-0xv3ms7rknWmcq83el0bYsQEk5mCSABjmgb5zTnAiEA5wg4T472gwtr9rxDUqoFoi0iUiiL6rUL_BiHxmN_YBU%3D&lsparams=mm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AHylml4wRQIgT9_eRsRlkqa5CBfomyI55O_YVWB8Sf8-YGVY1U6jO5cCIQDSK381OiVtq8XJ48vPb0e5qNQ4rH7ctR9qqgKCJW1E7w%3D%3D","quality":"hd720","qualityLabel":"720p","width":1280,"contentLength":"20735401
```

## 実機でバッグ

```
$ lsusb
Bus 001 Device 005: ID 2717:ff40 Xiaomi Inc. Mi/Redmi series (MTP)
```

```
$ sudo nvim /etc/udev/rules.d/51-android.rules
SUBSYSTEM=="usb", ATTR{idVendor}=="[調べたUSBベンダーID4桁]", MODE="0666", GROUP="plugdev"
```

上記の場合は'2717'

